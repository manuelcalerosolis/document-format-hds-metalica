<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <report
            id="document_invoice_hds_metalica.report_saleorder_format"
            string="Pedido / Presupuesto HDS Metalica"
            model="sale.order"
            report_type="qweb-pdf"
            name="document_invoice_hds_metalica.format_report_saleorder_hds_metalica"
            print_report_name="(object._get_report_base_filename())"
            paperformat="document_invoice_hds_metalica.paperformat_invoice_hds_metalica"
        />

        <template id="document_invoice_hds_metalica.format_report_saleorder_hds_metalica">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="document_invoice_hds_metalica.report_saleorder_hds_metalica"/>
                </t>
            </t>
        </template>

         <template id="document_invoice_hds_metalica.report_saleorder_hds_metalica">
            <t t-name="document_invoice_hds_metalica.report_saleorder_hds_metalica">
                <t t-call="document_invoice_hds_metalica.external_layout_clean_hds_metalica">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="page">
                        <!-- Variables para footer -->
                        <t t-set="move_type" t-value=""/>
                        <t t-set="document_type" t-value="o.state"/>
                        <t t-set="bruto" t-value="o.amount_untaxed"/>
                        <t t-set="total_factura" t-value="o.amount_total"/>
                        <t t-set="modo_pago" t-value="o.payment_term_id.name"/>
                        <t t-set="importe_iva" t-value="0"/>
                        <t t-set="importe_recargo" t-value="0"/>
                        <t t-set="vencimiento" t-value="o.date_order"/>
                        <t t-set="banco_cuenta" t-value=""/>
                        <t t-set="banco_nombre" t-value=""/>
                        <t t-if="o.company_id.partner_id.bank_ids[:1]">
                            <t t-set="banco_cuenta" t-value="o.company_id.partner_id.bank_ids[:1].acc_number"/>
                            <t t-set="banco_nombre" t-value="o.company_id.partner_id.bank_ids[:1].bank_id.name"/>
                        </t>
                        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                            <t t-if="amount_by_group[5] == 1 and o.amount_untaxed == amount_by_group[2]">
                                <t t-if="amount_by_group[1] > 0">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                            <t t-else="">
                                <t t-set="tax_name" t-value="amount_by_group[0]"/>
                                <t t-set="tax_name" t-value="tax_name.find('Recargo')"/>
                                <t t-set="importe_recargo" t-value="tax_name"/>
                                <t t-if="tax_name == 0">
                                    <t t-set="importe_recargo" t-value="amount_by_group[1]"/>
                                </t>
                                <t t-else="">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                        </t>
                        <!-- Fin variables para el footer -->
                        <!--Datos de empresa y cliente -->
                        <div class="row" style="margin:0;padding:0;">
                            <div class="col-6" style="margin-left:-30px;">
                                <div style="width:100%;overflow:hidden;border:2px solid black;">
                                    <div style="width:50%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0;padding:0;font-weight:bolder;margin-left:2px;">Emisor</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;margin-left:2px;">
                                            <li t-if="o.company_id.name">
                                                <span t-field="o.company_id.name"/>
                                            </li>
                                            <li t-if="o.company_id.vat">
                                                <span t-field="o.company_id.vat"/>
                                            </li>
                                            <li t-if="o.company_id.street">
                                                <span t-field="o.company_id.street"/>
                                            </li>
                                            <li>
                                                <t t-if="o.company_id.zip">
                                                    <span t-field="o.company_id.zip"/>
                                                </t>
                                                <t t-if="'zip_id' in o.fields_get() and o.company_id.zip_id.city_id">
                                                    <span t-field="o.company_id.zip_id.city_id.name"/>
                                                </t>
                                                <t t-if="o.company_id.state_id">
                                                    (<span t-field="o.company_id.state_id.name"/>)
                                                </t>
                                            </li>
                                            <li t-if="o.company_id.phone">Tel.
                                                <span t-field="o.company_id.phone"/>
                                            </li>
                                            <li t-if="o.company_id.email">
                                                <span t-field="o.company_id.email"/>
                                            </li>
                                        </ul>
                                        <div style="width:100%;background-color:#DFD9D8;">
                                            <t t-if="document_type == 'draft'">
                                                <p style="margin:0;padding:0;font-weight:bolder;height:100%;margin-left:2px;">
                                                    Nº Presupuesto
                                                </p>
                                            </t>
                                            <t t-else="">
                                                <p style="margin:0;padding:0;font-weight:bolder;height:100%;margin-left:2px;">
                                                    Nº Pedido
                                                </p>
                                            </t>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;height:100%;margin-left:2px;font-size:0.9em;">
                                            <li>
                                                <span t-field="o.name"/>
                                            </li>
                                        </ul>
                                    </div>
                                    <div style="width:50%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0!important;padding:0;font-weight:bolder;">Destinatario</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;">
                                            <li t-if="o.partner_id.name">
                                                <span t-field="o.partner_id.name"/>
                                            </li>
                                            <li t-if="o.partner_id.vat">CIF:
                                                <span t-field="o.partner_id.vat"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.street"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.zip"/>
                                                <span t-field="o.partner_id.city"/>
                                                (<span t-field="o.partner_id.state_id.name"/>)
                                            </li>
                                            <li>Tel.
                                                <span t-field="o.partner_id.phone"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.email"/>
                                            </li>
                                        </ul>
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0;padding:0;font-weight:bolder;">Fecha</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;height:100%;">
                                            <li>
                                                <span t-field="o.date_order" t-options='{"widget": "date", "format": "dd/MM/Y"}'/>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-1">
                                <div class="row">

                                </div>
                            </div>
                            <div class="col-5" style="margin-left:47px;">
                                <div class="row">
                                    <div style="width:100%;height:110px;border:2px solid black;">
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;">
                                            <li t-if="o.partner_id.name">
                                                <span t-field="o.partner_id.name"/>
                                            </li>
                                            <li t-if="o.partner_id.vat">CIF:
                                                <span t-field="o.partner_id.vat"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.street"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.zip"/>
                                                <span t-field="o.partner_id.city"/>
                                                (<span t-field="o.partner_id.state_id.name"/>)
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="row">
                                    <div style="width:100%;height:50px;margin-top:85px;">
                                        <span style="font-weight:bolder;font-size:1.1em;">Obra:</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Fin datos de empresa y cliente -->
                        <!-- Lineas del pedido -->
                        <div class="row">
                            <table style="margin-top:10px; height:100%;"
                                   class="col-12">
                                <!-- Cabecera Lineas -->
                                <thead>
                                    <tr style="width:100%;background-color:#DFD9D8;height:100%;">
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Concepto</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Cantidad</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Precio</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Importe</b>
                                            </span>
                                        </td>
                                    </tr>
                                </thead>
                                <!-- Fin cabecera Lineas -->
                                <!--  Variables  -->
                                <t t-set="current_subtotal" t-value="0"/>
                                <t t-set="current_bruto" t-value="0"/>
                                <!--  Fin variables  -->
                                <tbody class="sale_tbody" style="border-bottom:4px solid black; height:100%;">
                                    <t t-foreach="o.order_line" t-as="line">
                                        <tr style="border-bottom:2px solid black; height:100%;">

                                            <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.product_id">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.product_uom_qty"
                                                          t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_unit"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_subtotal"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                        </tr>
                                    </t>
                                </tbody>

                            </table>
                        </div>
                        <!-- Fin lineas del pedido -->
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
