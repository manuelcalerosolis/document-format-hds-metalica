<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <record id="paperformat_sale_hds_metalica" model="report.paperformat">
            <field name="name">Presupuesto HDS Metalica A4</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">36</field>
            <field name="margin_bottom">100</field>
            <field name="margin_left">7</field>
            <field name="margin_right">7</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">28</field>
            <field name="dpi">90</field>
        </record>

        <report
            id="document_invoice_hds_metalica.report_saleorder_format"
            string="Pedido / Presupuesto HDS Metalica"
            model="sale.order"
            report_type="qweb-pdf"
            name="document_invoice_hds_metalica.format_report_saleorder_hds_metalica"
            print_report_name="(object._get_report_base_filename())"
            paperformat="document_invoice_hds_metalica.paperformat_sale_hds_metalica"
        />

        <template id="document_invoice_hds_metalica.format_report_saleorder_hds_metalica">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="document_invoice_hds_metalica.report_saleorder_hds_metalica"/>
                </t>
            </t>
        </template>

         <template id="document_invoice_hds_metalica.report_saleorder_hds_metalica">
            <t t-name="document_invoice_hds_metalica.report_saleorder_hds_metalica">
                <t t-call="document_invoice_hds_metalica.external_layout_sale_hds_metalica">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="page">
                        <!-- Variables para footer -->
                        <t t-set="move_type" t-value=""/>
                        <t t-set="document_type" t-value="o.state"/>
                        <t t-set="bruto" t-value="o.amount_untaxed"/>
                        <t t-set="total_factura" t-value="o.amount_total"/>
                        <t t-set="modo_pago" t-value="o.payment_term_id.name"/>
                        <t t-set="importe_iva" t-value="0"/>
                        <t t-set="importe_recargo" t-value="0"/>
                        <t t-set="vencimiento" t-value="o.date_order"/>
                        <t t-set="banco_cuenta" t-value=""/>
                        <t t-set="banco_nombre" t-value=""/>
                        <t t-if="o.company_id.partner_id.bank_ids[:1]">
                            <t t-set="banco_cuenta" t-value="o.company_id.partner_id.bank_ids[:1].acc_number"/>
                            <t t-set="banco_nombre" t-value="o.company_id.partner_id.bank_ids[:1].bank_id.name"/>
                        </t>
                        <t t-if="document_type == 'sale'">
                            <t t-set="document_name" t-value="'PEDIDO'"/>
                        </t>
                        <t t-if="document_type == 'draft'">
                            <t t-set="document_name" t-value="'PRESUPUESTO'"/>
                        </t>

                        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                            <t t-if="amount_by_group[5] == 1 and o.amount_untaxed == amount_by_group[2]">
                                <t t-if="amount_by_group[1] > 0">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                            <t t-else="">
                                <t t-set="tax_name" t-value="amount_by_group[0]"/>
                                <t t-set="tax_name" t-value="tax_name.find('Recargo')"/>
                                <t t-set="importe_recargo" t-value="tax_name"/>
                                <t t-if="tax_name == 0">
                                    <t t-set="importe_recargo" t-value="amount_by_group[1]"/>
                                </t>
                                <t t-else="">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                        </t>
                        <!-- Fin variables para el footer -->
                        <!--Datos de empresa y cliente -->
                        <div class="row" style="margin:0;padding:0;">
                            <div class="col-7" style="margin-left:-30px;">
                                <div style="width:100%;overflow:hidden;border:2px solid black;">
                                    <div style="width:60%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0;padding:0;font-weight:bolder;margin-left:2px;">Emisor</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:100px;font-size:0.9em;margin-left:2px;">
                                            <li t-if="o.company_id.name">
                                                <span t-field="o.company_id.name"/>
                                            </li>
                                            <li t-if="o.company_id.vat">
                                                <span t-field="o.company_id.vat"/>
                                            </li>
                                            <li t-if="o.company_id.street">
                                                <span t-field="o.company_id.street"/>
                                            </li>
                                            <li>
                                                <t t-if="o.company_id.zip">
                                                    <span t-field="o.company_id.zip"/>
                                                </t>
                                                <t t-if="'zip_id' in o.fields_get() and o.company_id.zip_id.city_id">
                                                    <span t-field="o.company_id.zip_id.city_id.name"/>
                                                </t>
                                                <t t-if="o.company_id.state_id">
                                                    (<span t-field="o.company_id.state_id.name"/>)
                                                </t>
                                            </li>
                                            <li t-if="o.company_id.phone">Tel.
                                                <span t-field="o.company_id.phone"/>
                                            </li>
                                            <li t-if="o.company_id.email">
                                                <span t-field="o.company_id.email"/>
                                            </li>
                                        </ul>
                                    </div>
                                    <div style="width:40%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0!important;padding:0;font-weight:bolder;color:#DFD9D8">_</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;">
                                            <li>
                                                <b>Obra: </b>
                                                <span t-field="o.client_order_ref"/>
                                            </li>
                                            <li>
                                                <br/>
                                            </li>
                                            <li>
                                                <b>Fecha: </b>
                                                <span t-field="o.date_order" t-options='{"widget": "date", "format": "dd/MM/Y"}'/>
                                            </li>
                                            <li>
                                                <b>Referencia: </b>
                                                <span t-field="o.name"/>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-5" style="margin-left:47px;">
                                <div class="row">
                                    <div style="width:100%;height:110px;border:2px solid black;">
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;">
                                            <li t-if="o.partner_id.name">
                                                <span t-field="o.partner_id.name"/>
                                            </li>
                                            <li>
                                                <br/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.street"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.zip"/>
                                                <span t-field="o.partner_id.city"/>
                                                (<span t-field="o.partner_id.state_id.name"/>)
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Fin datos de empresa y cliente -->
                        <!-- Lineas del pedido -->
                        <div class="row">
                            <table style="margin-top:10px; height:100%;"
                                   class="col-12">
                                <!-- Cabecera Lineas -->
                                <thead>
                                    <tr style="width:100%;background-color:#DFD9D8;height:100%;">
                                        <td style="width:70%; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Concepto</b>
                                            </span>
                                        </td>
                                        <td style="width:10%; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Cantidad</b>
                                            </span>
                                        </td>
                                        <td style="width:10%; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Precio</b>
                                            </span>
                                        </td>
                                        <td style="width:10%; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Importe</b>
                                            </span>
                                        </td>
                                    </tr>
                                </thead>
                                <!-- Fin cabecera Lineas -->
                                <!--  Variables  -->
                                <t t-set="current_subtotal" t-value="0"/>
                                <t t-set="current_bruto" t-value="0"/>
                                <!--  Fin variables  -->
                                <tbody class="sale_tbody" style="border-bottom:4px solid black; height:100%;">
                                    <t t-foreach="o.order_line" t-as="line">
                                        <tr style="border-bottom:2px solid black; height:100%;">

                                            <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.product_id">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.product_uom_qty"
                                                          t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
                                                </t>
                                                <t t-else="">
                                                    <span/>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_unit"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span/>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_subtotal"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span/>
                                                </t>
                                            </td>

                                        </tr>
                                    </t>
                                </tbody>

                            </table>
                        </div>
                        <!-- Fin lineas del pedido -->

                        <div class="row" style="margin-top:5px;">
                            <div class="col-12">
                                <div style="margin-left:-1.8%; width:103.6%; clear:both; border: 2px solid black; height:52px;">
                                    <!-- Cabecera tabla 1 footer -->
                                    <div
                                        style="text-align:center;background-color:#DFD9D8;height:25px;border-bottom:2px solid black;">
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <b>
                                                <span>Importe Bruto</span>
                                            </b>
                                        </div>
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <b>
                                                <span>Base Imponible</span>
                                            </b>
                                        </div>
                                        <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                            <b>
                                                <span>% IVA</span>
                                            </b>
                                        </div>
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <b>
                                                <span>Importe IVA</span>
                                            </b>
                                        </div>
                                        <div style="width:24%;float:left;height:25px;">
                                            <b>
                                                <span>TOTAL </span>
                                                <span t-esc="document_name"/>
                                            </b>
                                        </div>
                                    </div>
                                    <!-- Fin cabecera tabla 1 footer -->
                                    <!-- datos tabla 1 footer -->
                                    <div style="text-align:right;height:25px;">
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <span style="margin-right:2px;" t-esc="bruto"
                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                        </div>
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <span style="margin-right:2px;" t-esc="bruto"
                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                        </div>
                                        <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                            <span style="margin-right:2px;">21%</span>
                                        </div>
                                        <div style="width:20%;float:left;border-right:2px solid black;height:25px;">
                                            <span style="margin-right:2px;" t-esc="importe_iva"
                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                        </div>
                                        <div style="width:24%;float:left;height:25px;">
                                            <span style="margin-right:2px;" t-esc="total_factura"
                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                        </div>
                                    </div>
                                    <!-- Fin datos tabla 1 footer -->
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="row">
                                <div class="col-12">
                                    <br/>
                                    <div style="width:100%;float:left;height:25px;">
                                        <span>Observaciones</span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12 custom_footer">
                                    <ul style="list-style-type:none;font-size:1.0em;!important;width:100%;">
                                        <li>
                                            - El presente documento tiene una validez de 30 días desde su fecha indicada
                                        </li>
                                        <li>
                                            - El presente documento solo incluye los materiales y trabajos en él
                                            especificados.
                                            Cualquier otro material o trabajo adicional se presupuestará aparte
                                        </li>
                                        <li>
                                            - El cliente autoriza a la empresa a procesar los datos existente de acuerdo
                                            al RGPD
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <br/>
                            <div class="row custom_sing">
                                <div class="col-12">
                                    <div style="width:50%;float:left;height:25px;">
                                        <span>Nombre y Apellidos:</span>
                                    </div>
                                    <div style="width:50%;float:left;height:25px;">
                                        <span style="display:block;text-align:right;">ACEPTO EL PRESUPUESTO</span>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-12">
                                    <div style="width:50%;float:left;height:25px;">
                                        <span>Fecha:</span>
                                    </div>
                                    <div style="width:50%;float:left;height:25px;">
                                        <span style="display:block;text-align:right;">Firma del Cliente</span>
                                    </div>
                                </div>
                            </div>
                            <br/>
                        </div>

                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
