<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <record id="paperformat_invoice_hds_metalica" model="report.paperformat">
            <field name="name">Factura HDS Metalica A4</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">36</field>
            <field name="margin_bottom">25</field>
            <field name="margin_left">7</field>
            <field name="margin_right">7</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">28</field>
            <field name="dpi">90</field>
        </record>

        <report
            id="report_invoice_format"
            string="Factura HDS Metalica"
            model="account.move"
            report_type="qweb-pdf"
            name="document_invoice_hds_metalica.format_report_invoice_hds_metalica"
            print_report_name="(object._get_report_base_filename())"
            paperformat="document_invoice_hds_metalica.paperformat_invoice_hds_metalica"
        />

        <template id="format_report_invoice_hds_metalica">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="document_invoice_hds_metalica.report_invoice_hds_metalica"/>
                </t>
            </t>
        </template>

        <template id="document_invoice_hds_metalica.report_invoice_hds_metalica">
            <t t-name="document_invoice_hds_metalica.report_invoice_hds_metalica">
                <t t-call="document_invoice_hds_metalica.external_layout_invoice_hds_metalica">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="page">
                        <!-- Variables para footer -->
                        <t t-set="move_type" t-value="o.move_type"/>
                        <t t-set="document_type" t-value="o.state"/>
                        <t t-set="bruto" t-value="o.amount_untaxed"/>
                        <t t-set="total_factura" t-value="o.amount_total"/>
                        <t t-set="modo_pago" t-value="o.invoice_payment_term_id.name"/>
                        <t t-set="importe_iva" t-value="0"/>
                        <t t-set="importe_recargo" t-value="0"/>
                        <t t-set="vencimiento" t-value="o.invoice_date_due"/>
                        <t t-set="banco_cuenta" t-value=""/>
                        <t t-set="banco_nombre" t-value=""/>
                        <t t-if="o.company_id.partner_id.bank_ids[:1]">
                            <t t-set="banco_cuenta" t-value="o.company_id.partner_id.bank_ids[:1].acc_number"/>
                            <t t-set="banco_nombre" t-value="o.company_id.partner_id.bank_ids[:1].bank_id.name"/>
                        </t>
                        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                            <t t-if="amount_by_group[5] == 1 and o.amount_untaxed == amount_by_group[2]">
                                <t t-if="amount_by_group[1] > 0">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                            <t t-else="">
                                <t t-set="tax_name" t-value="amount_by_group[0]"/>
                                <t t-set="tax_name" t-value="tax_name.find('Recargo')"/>
                                <t t-set="importe_recargo" t-value="tax_name"/>
                                <t t-if="tax_name == 0">
                                    <t t-set="importe_recargo" t-value="amount_by_group[1]"/>
                                </t>
                                <t t-else="">
                                    <t t-set="importe_iva" t-value="amount_by_group[1]"/>
                                </t>
                            </t>
                        </t>
                        <!-- Fin variables para el footer -->
                        <!--Datos de empresa y cliente -->
                        <div class="row" style="margin:0;padding:0;">
                            <div style="margin-left:-1.8%;width:53.999999998%;">
                                <div style="width:100%;overflow:hidden;border:2px solid black;">
                                    <div style="width:45%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0;padding:0;font-weight:bolder;margin-left:2px;">Emisor</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;margin-left:2px;">
                                            <li t-if="o.company_id.name">
                                                <span t-field="o.company_id.name"/>
                                            </li>
                                            <li t-if="o.company_id.vat">
                                                <span t-field="o.company_id.vat"/>
                                            </li>
                                            <li t-if="o.company_id.street">
                                                <span t-field="o.company_id.street"/>
                                            </li>
                                            <li>
                                                <t t-if="o.company_id.zip">
                                                    <span t-field="o.company_id.zip"/>
                                                </t>
                                                <t t-if="'zip_id' in o.fields_get() and o.company_id.zip_id.city_id">
                                                    <span t-field="o.company_id.zip_id.city_id.name"/>
                                                </t>
                                                <t t-if="o.company_id.state_id">
                                                    (<span t-field="o.company_id.state_id.name"/>)
                                                </t>
                                            </li>
                                            <li t-if="o.company_id.phone">Tel.
                                                <span t-field="o.company_id.phone"/>
                                            </li>
                                            <li t-if="o.company_id.email">
                                                <span t-field="o.company_id.email"/>
                                            </li>
                                        </ul>
                                        <div style="width:100%;background-color:#DFD9D8;">
                                            <p style="margin:0;padding:0;font-weight:bolder;height:100%;margin-left:2px;">
                                                Nº Factura
                                            </p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;height:100%;margin-left:2px;font-size:0.9em;">
                                            <li>
                                                <span t-field="o.name"/>
                                            </li>
                                        </ul>
                                    </div>
                                    <div style="width:55%;float:left;">
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0!important;padding:0;font-weight:bolder;">Destinatario</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;">
                                            <li t-if="o.partner_id.name">
                                                <span t-field="o.partner_id.name"/>
                                            </li>
                                            <li t-if="o.partner_id.vat">CIF:
                                                <span t-field="o.partner_id.vat"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.street"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.zip"/>
                                                <span t-field="o.partner_id.city"/>
                                                (<span t-field="o.partner_id.state_id.name"/>)
                                            </li>
                                            <li>Tel.
                                                <span t-field="o.partner_id.phone"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.email"/>
                                            </li>
                                        </ul>
                                        <div style="width:100%;background-color:#DFD9D8;height:100%;">
                                            <p style="margin:0;padding:0;font-weight:bolder;">Fecha</p>
                                        </div>
                                        <ul style="list-style-type:none;margin:0;padding:0;height:100%;">
                                            <li>
                                                <span t-field="o.invoice_date"/>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-left:9.733333333%;width:38.066666669%;">
                                <div class="row">
                                    <div style="width:100%;height:110px;border:2px solid black;">
                                        <ul style="list-style-type:none;margin:0;padding:0;min-height:170px;font-size:0.9em;margin-left:2px;">
                                            <li t-if="o.partner_id.name">
                                                <span t-field="o.partner_id.name"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.street"/>
                                            </li>
                                            <li>
                                                <span t-field="o.partner_id.zip"/>
                                                <span t-field="o.partner_id.city"/>
                                                (<span t-field="o.partner_id.state_id.name"/>)
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="row">
                                    <div style="width:100%;height:50px;margin-top:85px;">
                                        <span style="font-weight:bolder;font-size:1.1em;">Obra:</span>
                                        <span t-if="o.partner_id.ref" t-field="o.partner_id.ref"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Fin datos de empresa y cliente -->
                        <!-- Lineas del pedido -->
                        <div class="row">
                            <table style="margin-top:10px; height:100%;"
                                   class="col-12">
                                <!-- Cabecera Lineas -->
                                <thead>
                                    <tr style="width:100%;background-color:#DFD9D8;height:100%;">
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Concepto</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Cantidad</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Precio</b>
                                            </span>
                                        </td>
                                        <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                            <span>
                                                <b>Importe</b>
                                            </span>
                                        </td>
                                    </tr>
                                </thead>
                                <!-- Fin cabecera Lineas -->
                                <!--  Variables  -->
                                <t t-set="current_subtotal" t-value="0"/>
                                <t t-set="current_bruto" t-value="0"/>
                                <!--  Fin variables  -->
                                <tbody class="sale_tbody" style="border-bottom:4px solid black; height:100%;">
                                    <t t-foreach="o.invoice_line_ids" t-as="line">
                                        <tr style="border-bottom:2px solid black; height:100%;">

                                            <td style="padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.product_id">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.quantity"
                                                          t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_unit"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                            <td style="text-align:right; padding:2px; margin:2px; font-size:0.9em; border-top:2px solid black; border-bottom:2px solid black; border-right:2px solid black; border-left:2px solid black;">
                                                <t t-if="line.price_unit">
                                                    <span style="margin-right:2px;"
                                                          t-field="line.price_subtotal"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                                <t t-else="">
                                                    <span></span>
                                                </t>
                                            </td>

                                        </tr>
                                    </t>
                                </tbody>

                            </table>
                        </div>
                        <!-- Fin lineas de la factura -->
                        <!-- Totales de la factura -->
                        <div class="clearfix">
                            <div class="row" style="margin-top:5px;">
                                <div class="col-12" style="border:1px solid black;">
                                    <div style="margin-left:-1.8%; width:103.6%; clear:both; border: 2px solid black; height:52px;">
                                        <!-- Cabecera tabla 1 footer -->
                                        <div
                                            style="text-align:center;background-color:#DFD9D8;height:25px;border-bottom:2px solid black;">
                                            <div
                                                style="width:15%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>Importe Bruto</span>
                                                </b>
                                            </div>
                                            <div
                                                style="width:14.75%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>Base Imponible</span>
                                                </b>
                                            </div>
                                            <div style="width:10%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>% IVA</span>
                                                </b>
                                            </div>
                                            <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>Importe IVA</span>
                                                </b>
                                            </div>
                                            <div style="width:10%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>Retención</span>
                                                </b>
                                            </div>
                                            <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span>Importe Retención</span>
                                                </b>
                                            </div>
                                            <div style="width:18.25%;float:left;height:25px;">
                                                <b>
                                                    <span>TOTAL FACTURA</span>
                                                </b>
                                            </div>
                                        </div>
                                        <!-- Fin cabecera tabla 1 footer -->
                                        <!-- datos tabla 1 footer -->
                                        <div style="text-align:right;height:25px;">
                                            <div
                                                style="width:15%;float:left;;border-right:2px solid black;height:25px;">
                                                <span style="margin-right:2px;" t-esc="bruto"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </div>
                                            <div
                                                style="width:14.75%;float:left;border-right:2px solid black;height:25px;">
                                                <span style="margin-right:2px;" t-esc="bruto"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </div>
                                            <div style="width:10%;float:left;border-right:2px solid black;height:25px;">
                                                <span style="margin-right:2px;">21%</span>
                                            </div>
                                            <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                                <span style="margin-right:2px;" t-esc="importe_iva"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </div>
                                            <div style="width:10%;float:left;border-right:2px solid black;height:25px;">
                                                <t t-if="importe_recargo > 0">
                                                    <span style="margin-right:2px;">5.2%</span>
                                                </t>
                                            </div>
                                            <div style="width:16%;float:left;border-right:2px solid black;height:25px;">
                                                <t t-if="importe_recargo > 0">
                                                    <span style="margin-right:2px;" t-esc="importe_recargo"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </t>
                                            </div>
                                            <div style="width:18.25%;float:left;height:25px;">
                                                <span style="margin-right:2px;" t-esc="total_factura"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </div>
                                        </div>
                                        <!-- Fin datos tabla 1 footer -->
                                    </div>
                                </div>
                            </div>

                            <div class="row" style="margin-top:5px;">
                                <div class="col-5">
                                    <div style="margin-left:-4.8%; width:108.8%; border: 2px solid black; height:52px;">
                                        <!-- Cabecera tabla 2 footer -->
                                        <div
                                            style="height:25px;border-bottom:2px solid black; background-color:#DFD9D8;text-align:center;">
                                            <div style="width:72.5%;float:left;border-right:2px solid black;">
                                                <b>
                                                    <span>Importe</span>
                                                </b>
                                            </div>
                                            <div style="width:24.5%;float:left;">
                                                <b>
                                                    <span>VTO.</span>
                                                </b>
                                            </div>
                                        </div>
                                        <!-- Fin cabecera tabla 2 footer -->
                                        <!-- Datos tabla 2 footer -->
                                        <div style="height:25px;border-bottom:2px solid black;">
                                            <div
                                                style="width:72.5%; float:left; border-right:2px solid black; text-align:right;">
                                                <span style="margin-right:2px;"
                                                      t-esc="total_factura"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </div>
                                            <div style="width:24.5%;float:left;text-align:center;">
                                                <span style="margin-left:2px;"
                                                      t-esc="vencimiento"
                                                      t-options='{"widget": "date", "format": "dd/MM/yy"}'/>
                                            </div>
                                        </div>
                                        <!-- Fin datos tabla 2 footer -->
                                    </div>
                                </div>
                                <div class="col-1"></div>
                                <div class="col-6" style="font-size:1em;">
                                    <div style="clear:both; border: 2px solid black; height:106px;width:104%;">
                                        <div
                                            style="height:25px;border-bottom:2px solid black; background-color:#DFD9D8;text-align:center;">
                                            <b>
                                                <span>Forma de Pago</span>
                                            </b>
                                        </div>
                                        <div style="height:25px;border-bottom:2px solid black;text-align:center;">
                                            <span t-esc="modo_pago"/>
                                        </div>
                                        <div style="height:52px">
                                            <div
                                                style="width:22%;float:left;border-right:2px solid black;height:25px;border-bottom:2px solid black;">
                                                <b>
                                                    <span style="margin-left:2px;">Banco</span>
                                                </b>
                                            </div>
                                            <div
                                                style="width:78%;float:left;height:25px;border-bottom:2px solid black;">
                                                <span t-esc="banco_nombre" style="margin-left:2px;"></span>
                                            </div>
                                            <div style="width:22%;float:left;border-right:2px solid black;height:25px;">
                                                <b>
                                                    <span style="margin-left:2px;">IBAN</span>
                                                </b>
                                            </div>
                                            <div style="width:78%;float:left;height:25px;">
                                                <span t-esc="banco_cuenta" style="margin-left:2px;"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- Fin totales de la factura -->
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
